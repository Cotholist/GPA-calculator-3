# GPA 计算器项目文档

## 项目概述
这是一个基于现代 Web 技术构建的 GPA（Grade Point Average）计算器。该应用采用前后端分离架构，使用 Cloudflare 的服务进行部署，提供实时计算和数据持久化功能。

## 技术栈详情

### 前端技术
- **核心技术**:
  - 原生 JavaScript (ES6+)
  - 未使用前端框架（如 React、Vue 等），保持轻量级和高性能
  - 单页面应用 (SPA) 架构
- **UI 框架**:
  - Bootstrap 5.3.0 用于响应式布局和组件
  - Bootstrap Icons 1.7.2 用于图标系统
  - 未使用其他 UI 库（如 Material-UI、Tailwind CSS）
- **构建工具**:
  - 不使用构建工具，直接使用原生 JS 和 CSS
  - 通过 CDN 引入依赖
- **部署平台**:
  - Cloudflare Pages 用于静态资源托管
  - 自动化部署流程

### 后端技术
- **服务器环境**:
  - Cloudflare Workers（边缘计算平台）
  - 无需传统服务器维护
- **数据库选择**:
  - Cloudflare D1（兼容 SQLite 的分布式数据库）
  - 不使用传统数据库（如 MySQL、PostgreSQL）
  - 不使用第三方服务（如 Firebase、Supabase）
- **API 架构**:
  - WebSocket 用于实时通信
  - RESTful API 用于基本操作
- **认证系统**:
  - 目前未实现用户认证
  - 计划未来可能添加 Cloudflare Access 进行身份验证

## 当前功能和结构

### 应用类型
- 单页面应用 (SPA)
  - 所有功能集成在单个页面
  - 无需页面刷新的实时更新
  - 响应式设计，适配所有设备

### 核心功能
1. **课程管理**
   - 添加/删除课程
   - 实时保存课程信息
   - 多考试成绩支持

2. **GPA 计算**
   - 实时计算单课程 GPA
   - 自动计算总体 GPA
   - 支持不同权重的考试成绩

3. **用户界面**
   - 清晰的表单布局
   - 实时状态反馈
   - 错误提示系统
   - 响应式设计

### 数据存储方案
1. **数据库选择**
   - 使用 Cloudflare D1
   - SQL 查询支持
   - 自动备份和恢复
   
2. **数据模型**
   - 课程信息表
   - 考试成绩存储
   - 实时同步机制

### UI/UX 设计
1. **界面框架**
   - Bootstrap 5 提供基础组件
   - 自定义样式优化
   - 响应式布局

2. **交互设计**
   - 实时反馈机制
   - 错误提示系统
   - 加载状态指示
   - 表单验证

3. **视觉设计**
   - 简洁现代的界面风格
   - 清晰的信息层级
   - 适配深浅色模式（计划中）

## 未来规划

### 认证系统
- 计划使用 Cloudflare Access
- 支持多用户系统
- 数据隔离和权限控制

### UI/UX 改进
- 可能引入 Tailwind CSS
- 添加深色模式支持
- 优化移动端体验

### 功能扩展
- 课程导入/导出
- 成绩趋势分析
- 学期管理功能

## 系统架构

### 前端架构
1. **单页面应用**
   - 所有功能集成在单个 HTML 文件中
   - 使用模块化 JavaScript 组织代码
   - 响应式设计，适配不同屏幕尺寸

2. **实时通信**
   - 使用 WebSocket 与后端保持实时连接
   - 实现自动重连机制
   - 连接状态实时显示

3. **错误处理**
   - 统一的错误提示机制
   - 使用 Toast 组件展示错误信息
   - 支持详细的调试信息显示

### 后端架构
1. **无服务器架构**
   - 使用 Cloudflare Workers 运行后端代码
   - 支持全球分布式部署

2. **数据存储**
   - 使用 Cloudflare D1 数据库
   - 支持 SQL 查询
   - 实现数据持久化

3. **API 设计**
   - WebSocket 接口支持实时数据更新
   - REST API 支持基本的 CRUD 操作
   - 实现速率限制保护

## 主要功能

### 1. 课程管理
- 添加课程信息
- 删除课程记录
- 实时更新课程列表

### 2. 成绩计算
- 支持多个考试成绩输入
- 计算单课程 GPA
- 计算总体 GPA

### 3. 用户界面
- 实时反馈连接状态
- 错误提示和调试信息
- 响应式设计

## 数据结构

### 课程数据模型
```javascript
{
    id: number,            // 课程ID
    name: string,          // 课程名称
    regular_score: number, // 平时成绩
    exam_scores: string,   // JSON格式的考试成绩数组
    final_score: number,   // 最终成绩
    gpa: number           // 课程GPA
}
```

## 安全特性

1. **输入验证**
   - 客户端表单验证
   - 服务端数据验证
   - 防止 SQL 注入

2. **速率限制**
   - 基于 IP 的请求限制
   - 防止 DDoS 攻击

3. **错误处理**
   - 统一的错误处理机制
   - 用户友好的错误提示
   - 详细的调试信息

## 部署说明

### 前端部署 (Cloudflare Pages)
1. 构建命令:
   ```bash
   cd packages/frontend && npm install && mkdir -p dist && cp -r src/* dist
   ```
2. 构建输出目录: `packages/frontend/dist`
3. 根目录: `/`

### 后端部署 (Cloudflare Workers)
1. 使用 Wrangler 进行部署
2. 需要配置 Cloudflare D1 数据库
3. 配置 WebSocket 路由

## 开发指南

### 本地开发
1. 克隆仓库
2. 安装依赖: `npm install`
3. 启动开发服务器: `npm run dev`

### 代码结构
```
/packages
  /frontend
    /src
      - index.html      # 前端主文件
  /backend
    /src
      - worker.js       # 后端主文件
```

## 未来改进计划
1. 添加用户认证系统
2. 支持课程权重设置
3. 添加数据导出功能
4. 优化移动端体验
5. 添加深色模式支持

## 技术债务和注意事项
1. 需要优化错误处理机制
2. 考虑添加前端状态管理
3. 可以考虑使用打包工具优化前端资源
4. 需要添加更多的单元测试
